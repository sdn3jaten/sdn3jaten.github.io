<html lang="id">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Nota Pengeluaran</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: linear-gradient(359deg, #0f766e, #000000);
            min-height: 100vh;
        }
        .aspect-square {
            aspect-ratio: 1 / 1;
        }
        #modalImage {
            border-radius: 0.5rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }
        #modalImage::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        #modalImage::-webkit-scrollbar-thumb {
            background-color: rgba(255,255,255,0.3);
            border-radius: 4px;
        }
    </style>
</head>
<body class="font-sans p-6 flex flex-col min-h-screen">
    <header class="mb-12 text-center max-w-4xl mx-auto px-4">
        <h1 class="text-white font-extrabold drop-shadow-lg mb-3 select-none text-4xl sm:text-5xl md:text-5xl lg:text-5xl xl:text-5xl truncate">Nota Pengeluaran</h1>
        <p class="text-teal-300 text-lg md:text-xl font-light tracking-wide select-none">Bukti nota pengeluaran Kas Kelas 5A</p>
    </header>

    <main class="flex-grow max-w-7xl mx-auto w-full px-4">
        <div id="gallery" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
            <div class="loading text-center py-16 text-teal-300 text-xl font-semibold select-none">Memuat gambar...</div>
        </div>
    </main>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center p-6 z-50 hidden">
        <button id="modalClose" class="absolute top-6 right-6 text-white text-4xl font-thin hover:text-teal-400 transition-colors focus:outline-none" aria-label="Tutup modal">&times;</button>
        <div class="max-w-full max-h-full max-w-[90vw] max-h-[90vh] flex flex-col items-center">
            <img id="modalImage" src="" alt="" class="max-w-full max-h-full rounded-2xl shadow-2xl object-contain" />
            <p id="modalTitle" class="mt-6 text-white text-2xl font-semibold text-center bg-black bg-opacity-50 px-6 py-3 rounded-xl max-w-[90vw] select-text"></p>
        </div>
    </div>

    <script>
        // Konfigurasi
        const repoOwner = 'sdn3jaten';
        const repoName = 'sdn3jaten.github.io';
        const folderPath = 'nota';

        // Fungsi untuk mengambil daftar file dari GitHub API
        async function fetchImages() {
            try {
                const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${folderPath}`);

                if (!response.ok) {
                    throw new Error(`Gagal mengambil data: ${response.status}`);
                }

                const files = await response.json();
                displayImages(files);
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('gallery').innerHTML = `
                    <div class="error text-red-400 text-center py-16 text-xl font-semibold select-none">
                        <p>Gagal memuat gambar. Pastikan folder berisi gambar.</p>
                        <p>Detail: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Fungsi untuk mengubah nama file menjadi judul yang lebih rapi
        function formatTitle(filename) {
            let name = filename.replace(/\.[^/.]+$/, "");
            name = name.replace(/[-_]+/g, " ");
            name = name.replace(/\b\w/g, c => c.toUpperCase());
            return name;
        }

        // Fungsi untuk menampilkan gambar
        function displayImages(files) {
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';

            const imageFiles = files.filter(file => {
                const imageExtensions = ['.jpg', '.jpeg', '.png', '.gif', '.webp', '.bmp'];
                return imageExtensions.some(ext => file.name.toLowerCase().endsWith(ext));
            });

            if (imageFiles.length === 0) {
                gallery.innerHTML = `
                    <div class="error text-red-400 text-center py-16 text-xl font-semibold select-none">
                        <p>Belum ada</p>
                        <p>Nota Pengeluaran</p>
                    </div>
                `;
                return;
            }

            imageFiles.forEach(file => {
                const item = document.createElement('div');
                item.className = 'gallery-item rounded-3xl overflow-hidden shadow-2xl hover:shadow-teal-500/70 transition-shadow duration-300 bg-white cursor-pointer flex flex-col select-none';

                const img = document.createElement('img');
                img.src = file.download_url;
                img.alt = formatTitle(file.name);
                img.loading = 'lazy';
                img.className = 'w-full aspect-square object-cover block rounded-t-3xl';

                const title = document.createElement('p');
                title.textContent = formatTitle(file.name);
                title.className = 'text-center text-gray-800 font-semibold mt-3 mb-4 px-4 truncate';

                item.appendChild(img);
                item.appendChild(title);

                item.addEventListener('click', () => {
                    openModal(file.download_url, formatTitle(file.name));
                });

                gallery.appendChild(item);
            });
        }

        // Fungsi buka modal
        function openModal(src, title) {
            const modal = document.getElementById('modal');
            const modalImage = document.getElementById('modalImage');
            const modalTitle = document.getElementById('modalTitle');

            modalImage.src = src;
            modalImage.alt = title;
            modalTitle.textContent = title;

            modal.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // Fungsi tutup modal
        function closeModal() {
            const modal = document.getElementById('modal');
            const modalImage = document.getElementById('modalImage');

            modal.classList.add('hidden');
            modalImage.src = '';
            modalImage.alt = '';
            document.body.style.overflow = '';
        }

        document.getElementById('modalClose').addEventListener('click', closeModal);

        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });

        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const modal = document.getElementById('modal');
                if (!modal.classList.contains('hidden')) {
                    closeModal();
                }
            }
        });

        window.addEventListener('DOMContentLoaded', fetchImages);
    </script>
</body>
</html>
